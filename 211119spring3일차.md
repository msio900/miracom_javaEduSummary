# 21.11.19.  spring-3일차

## 1118 수업 이슈

1. mySql

## mybatis 복습

![](./image/1119-01.png)

* `MySawon` : vo - 테이블에 대한 정보를 담음.
* `dbconn.properties`
  * `properties` : 파편적인 정보들을 `map`방식으로 모아둔 것을 이야기 함.
* `sawon_mapping.xml`
* `SqlMapConfig.xml` : 핵심이 되는 문서
  * DB 서버에 대한 정보를 가지고 있음. 
  * vo도 연결할 수 있음.

![](./image/1119-02.png)

* `SqlSessionFactory` : `SqlMapConfig.xml`에서 생성된 모든 것을 가져감.
* `SqlSession` : 결론적으로 얻어가기 위한것
  * 쿼리문을 실행하는 session을 가지고 있음. (INSERT, DELETE, UPDATE ... )

### 소스 코드

* `SqlMapConfig.xml` 

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
 PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-config.dtd">
 <!-- MyBatis에서 핵심이 되는 설정 문서... -->
 <configuration>
 <!-- 1. DB정보  Wiring -->
 <properties resource="config/dbconn.properties"/>
 <!-- 2. vo정보 Wiring -->
 <typeAliases>
 	<!-- 가장좋은 알리아스는 MySawon을 mySawon으로 -->
 	<typeAlias type="com.edu.mybatis.vo.MySawon" alias="mySawon"/>
 </typeAliases>
 <!-- 3. JDBC 환경 구축 -->
 <environments default="DEVELOPMENT">
 	<environment id="DEVELOPMENT">
 		<transactionManager type="JDBC"/>
 		<dataSource type="UNPOOLED">
 			<property name="driver" value="${jdbc.mysql.driver}"/>
 			<property name="url" value="${jdbc.mysql.url}"/>
 			<property name="username" value="${jdbc.mysql.username}"/>
 			<property name="password" value="${jdbc.mysql.password}"/>
 		</dataSource>
 	</environment>
 </environments>
 <!-- 4. SQL Mapper -->
 <mappers>
 	<mapper resource="sql/mysawon_mapping.xml"/>
 </mappers>
 </configuration>
```



* `SqlSessionFactory` , `SqlSession` 

```java
package com.edu.mybatis.test;

import java.io.Reader;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import com.edu.mybatis.vo.MySawon;

/*
 * MyBatis 프레임워크의 가장 핵심이 되는 설정 문서를 만들었다.
 * SqlMapConfig.xml
 * 
 * 이제 MyBatis프레임워크에서 제공하는 라이브러리 클래스를 이용해서
 * SqlMapConfig.xml을 읽어들이고
 * 쿼리문을 동작시켜보도록 하자.
 */
public class MySawonTestApp01 {

	public static void main(String[] args) throws Exception{
		// 1. 화면의 폼을 통해서 vo를 생성한다는 가정으로...
		MySawon vo = new MySawon();
		vo.setId("ddd");
		vo.setPwd("1224");
		vo.setName("도로시");
		vo.setAge(22);
		
		//2. 핵심이 되는 설정문서를 읽어들인다.
		Reader r = Resources.getResourceAsReader("config/SqlMapConfig.xml");
		
		//3. MyBatis 라이브러리..순서는 천천히 외우시면 됩니다.
		SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(r);
		
		//session 여기에 쿼리문 실행하는 기능이 다 들어있다.
		SqlSession session = factory.openSession();
		
		session.insert("sawonMapper.sawonAdd", vo);
		session.commit();
		
		session.close();
		
		System.out.println(vo.getName()+" 님이 회원등록 성공^^");
	}
}
```



* `mysawon_mapping.xml`

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="sawonMapper">
	<insert id="sawonAdd" parameterType="mySawon">
		INSERT
		INTO mysawon (id, pwd, name, age, hiredate)
		VALUE (#{id}, #{pwd},#{name},#{age},curdate())
	</insert>
 
 </mapper>
```



## MySql 정리

* SELECT문

```xml
 	<select id="sawonList" resultType="mySawon"> <!-- conection에 제너릭이 들어감. -->
 		SELECT
 		num, id, name, age, hiredate
 		FROM mysawon
 		ORDER BY num DESC
 	</select>
```

* mybatis 세션

```java
package com.edu.mybatis.test;

import java.io.Reader;
import java.util.List;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import com.edu.mybatis.vo.MySawon;
/*
 * SELECT문을 실행시키는 Test
 */
public class MySawonTestApp02 {

	public static void main(String[] args) throws Exception{
		//1. 핵심이 되는 설정문서를 읽어들인다.
		Reader r = Resources.getResourceAsReader("config/SqlMapConfig.xml");
		
		//2. MyBatis 라이브러리..순서는 천천히 외우시면 됩니다.
		SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(r);
		
		//3. session 여기에 쿼리문 실행하는 기능이 다 들어있다.
		SqlSession session = factory.openSession();
		
		List<MySawon> list = session.selectList("sawonMapper.sawonList"); // namespace.
		for (MySawon vo :list) {
			System.out.println(vo);
		}
	}
}
/*
 * 						SqlSessionFactory --> SqlSession
 * 									SqlSession
 * 	sql query									execute method
 * INSERT INTO ~			===			insert("namespace이름.id, vo);
 * DELETE FROM ~			===			delete("namespace이름.id, PK);
 * UPDATE table ~			===			update("namespace이름.id, vo);
 * ------------------------------------------------------------------------------------
 * SELECT * FROM			===			List<T> selectList("namespace이름.id");
 * 										List<T> selectList("namespace이름.id", "서울");
 * SELECT * FROM where		===			Object	selectOne("namespace이름.id", PK);
 */
```



## myBatis

```mysql
mysql> desc users
    -> ;
+-----------+-------------+------+-----+---------+-------+
| Field     | Type        | Null | Key | Default | Extra |
+-----------+-------------+------+-----+---------+-------+
| user_id   | varchar(10) | NO   | PRI | NULL    |       |
| user_name | varchar(10) | NO   |     | NULL    |       |
| password  | varchar(10) | NO   |     | NULL    |       |
| age       | int(3)      | YES  |     | NULL    |       |
| grade     | int(3)      | YES  |     | NULL    |       |
| reg_date  | date        | YES  |     | NULL    |       |
+-----------+-------------+------+-----+---------+-------+
6 rows in set (0.01 sec)
```

